generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("PG_HOST")
}

model client_pics {
  id         Int         @id @default(autoincrement())
  name       String      @db.VarChar(255)
  email      String?     @db.VarChar(255)
  phone      String?     @db.VarChar(50)
  title      String?     @db.VarChar(100)
  project_id Int
  client_id  Int
  clients    clients     @relation(fields: [client_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  projects   projects    @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  documents  documents[]
}

model clients {
  id                 Int           @id @default(autoincrement())
  name               String        @db.VarChar(255)
  masked_description String?
  address            String?
  phone              String?       @db.VarChar(50)
  npwp               String?       @db.VarChar(50)
  created_at         DateTime?     @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?     @default(now()) @db.Timestamptz(6)
  client_pics        client_pics[]
  documents          documents[]
  projects           projects[]
}

model documents {
  id             Int             @id @default(autoincrement())
  document_types document_types?
  number         String          @db.VarChar(100)
  date_created   DateTime?       @db.Date
  date_signed    DateTime?       @db.Date
  document_url   String?
  project_id     Int
  client_pic_id  Int
  client_id      Int
  clients        clients         @relation(fields: [client_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  client_pics    client_pics     @relation(fields: [client_pic_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  projects       projects        @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model employees {
  id                                                Int                    @id @default(autoincrement())
  nik                                               String                 @db.Char(16)
  nip                                               String                 @db.Char(18)
  name                                              String                 @db.VarChar(255)
  email                                             String                 @unique @db.VarChar(100)
  phone                                             String                 @db.VarChar(50)
  address                                           String                 @db.VarChar(100)
  position                                          String?                @db.VarChar(50)
  status                                            status_employees
  password                                          String                 @db.VarChar(255)
  refresh_token                                     String?
  project_team_members                              project_team_members[]
  project_teams_project_teams_auditor_idToemployees project_teams[]        @relation("project_teams_auditor_idToemployees")
  project_teams_project_teams_manager_idToemployees project_teams[]        @relation("project_teams_manager_idToemployees")
}

model project_team_members {
  id               Int           @id @default(autoincrement())
  role_id          Int
  project_teams_id Int
  job_description  String?       @db.VarChar(500)
  end_at           DateTime?     @db.Timestamp(6)
  employee_id      Int
  employees        employees     @relation(fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  project_teams    project_teams @relation(fields: [project_teams_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  role_levels      role_levels   @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model project_teams {
  id                                            Int                    @id @default(autoincrement())
  project_teams_name                            String                 @db.VarChar(100)
  project_teams_email                           String                 @db.VarChar(100)
  manager_id                                    Int
  auditor_id                                    Int?
  project_id                                    Int
  project_team_members                          project_team_members[]
  employees_project_teams_auditor_idToemployees employees?             @relation("project_teams_auditor_idToemployees", fields: [auditor_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  employees_project_teams_manager_idToemployees employees              @relation("project_teams_manager_idToemployees", fields: [manager_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  projects                                      projects               @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model projects {
  id             Int             @id @default(autoincrement())
  client_id      Int
  project_name   String          @db.VarChar(255)
  project_code   String          @unique @db.Char(7)
  project_type   project_types
  contract_value Decimal?        @db.Decimal(18, 2)
  started_at     DateTime?       @default(now()) @db.Timestamp(6)
  finished_at    DateTime?       @db.Timestamp(6)
  deleted_at     DateTime?       @db.Timestamp(6)
  is_deleted     Boolean?        @default(false)
  client_pics    client_pics[]
  documents      documents[]
  project_teams  project_teams[]
  clients        clients         @relation(fields: [client_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model role_levels {
  id                   Int                    @id @default(autoincrement())
  role_name            String?                @db.VarChar(50)
  role_level           Int?
  role_price           Decimal?               @db.Decimal(10, 2)
  is_default           Boolean?               @default(true)
  project_team_members project_team_members[]
}

enum document_types {
  BA
  OP
  BAST
}

enum project_types {
  ET
  FB
  MS
}

enum status_employees {
  freelance
  active
  resigned
}
